{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" type="text/css" href="{% static 'inventory.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsqr/1.4.0/jsqr.min.js"></script> <!-- Include jsQR -->
</head>
<body>
    {% include 'navigation_bar.html' %}

    <div class="container-fluid">
        <div class="row">
            {% include 'dashboard_side_navigation.html' %}

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" style="height: 93vh; overflow: auto; scroll-width: thin;">
                {% block content %}
                <!-- QR Code Scanner Content -->
                <h1>QR Code Scanner</h1>
                <video id="videoElement" autoplay style="width: 100%; height: auto; border: 1px solid black;"></video>
                <button id="scanButton" class="btn btn-primary mt-2">Scan QR Code</button>
                <p id="scannedValue" class="mt-3"></p>
                {% endblock %}
            </main>
            
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        const video = document.getElementById('videoElement');
        const scannedValueDisplay = document.getElementById('scannedValue');
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        // Access the webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Error accessing webcam: " + err);
            });

        // QR Code scanning logic
        document.getElementById('scanButton').addEventListener('click', () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, canvas.width, canvas.height);

            if (code) {
                const scannedValue = code.data;
                scannedValueDisplay.textContent = `Scanned Value: ${scannedValue}`;
                // Optionally, stop the video stream
                video.srcObject.getTracks().forEach(track => track.stop());
            } else {
                scannedValueDisplay.textContent = 'No QR code detected. Try again.';
            }
        });
    </script>
</body>
</html>
